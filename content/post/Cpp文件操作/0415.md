+++
date = '2025-04-15T13:28:45+08:00'
draft = true
title = 'CPP 文件操作'
author = 'Nacocx'
categories = [
    "笔记",
]
tags = [
    "c++",
    "lambda",
]
+++

# CPP 文件操作
## 1.顺序文件
以结构体数据操作为例，~~顺便练习一下Lambda表达式~~
```cpp
typedef struct Student{
    string name;
    int age;
    double height;
    Student(string n,int a,double h):name(n),age(a),height(h){}
    friend ofstream &operator<<(ofstream &out,const Student &stu){
        out<<stu.name<<"\t"<<stu.age<<"\t"<<stu.height<<"\n";
    return out;
    }
}St;
```
### 文件流写入数据
```cpp
string filepath="/home/sora/DOCS/my1/test001.txt";
function<void()> writedata=[&filepath](){
    St s1("张三三",19,1.77);
    St s2("李四",20,1.75);
    ofstream out1;
    out1.open(filepath);//打开文件到内存缓冲区（out1->该文件内存缓冲）
    out1<<s1<<s2;
    out1.close();
};
writedata();
```
### 文件流读取数据
#### 以空格分开读
```cpp
string filepath="/home/sora/DOCS/my1/test001.txt";
function<void()> readdata=[&filepath](){   
    ifstream cin1;
    cin1.open(filepath);
    function<void()> cin1out=[&cin1](int columns=3){
        string str;
        int cnt=0;
        while(cin1>>str){
            if(cnt==columns){cout<<'\n';cnt=0;}
            cout<<str<<'\t';
            cnt++;
        }
    };
    cin1out();
    cin1.close();
};
readdata();
```
#### 以行分开读
```cpp
string filepath="/home/sora/DOCS/my1/test001.txt";
function<void()> readdataln=[&filepath](){
        ifstream cin1;
        cin1.open(filepath);
        string str;
        while(!cin1.eof()){
            getline(cin1,str);
            cout<<str<<'\n';
        }
        cin1.close();
};
readdataln();
```
## 2.随机文件
当 `St` 结构体包含字符串（如`string name`）时，直接二进制读写会导致问题。因为字符串通常是动态分配的，直接写入指针值而不是实际字符串内容。故我们需要修改结构体：
```cpp
struct St {
    char name[50];//使用固定大小数组代替string
    int age;
    double height;
    St(const char* n,int a,double h):age(a),height(h){
        strncpy(name,n,sizeof(name)-1);
        name[sizeof(name)-1] = '\0';
    }
    St()=default;
};
```
### 写入数据
```cpp
string filepath="/home/sora/DOCS/my1/test010";
function<void()> writedatabin=[&filepath](){
    St s1("张三三",19,1.77);
    St s2("李四",20,1.75);
    St s3("Aminous",114,514);
    ofstream out1(filepath,ios::binary);
    out1.write((char*)&s1,sizeof(St));
    out1.write((char*)&s2,sizeof(St));
    out1.write((char*)&s3,sizeof(St));
    out1.close();
};
```
### 读取数据
```cpp
string filepath="/home/sora/DOCS/my1/test010";
function<void()> readdatabin=[&filepath](){
    ifstream cin1(filepath,ios::binary);
    vector<St> v;
    St T;
    while(cin1.read((char*)&T,sizeof(St)))
        v.push_back(T);
    for(const auto &s:v)
        cout << s.name << '\t' << s.age << '\t' << s.height << endl;
    cin1.close();
};
readdatabin();
```
